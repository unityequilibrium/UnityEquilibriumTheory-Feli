จัดให้แบบ **ฉบับสมบูรณ์**, **ระดับสถาปัตยกรรมบริษัทใหญ่**,  
**อ่านง่าย**, **สร้างโค้ดได้เลย**, และ **ตรงกับโครงสร้าง UET Platform ปัจจุบัน 100%**

นี่คือ **BLUEPRINT 0.6 — DATA_MODEL.md (ฉบับสมบูรณ์ที่สุด)**

> _Data Model = โครงสร้างข้อมูลรากฐานของทั้งระบบ UET Platform_  
> ทุกหน้า ทุกฟีเจอร์ ทุก Agent ต้องอ่านไฟล์นี้เพื่อเข้าใจระบบ

---

# 🟩 **BLUEPRINT 0.6 — DATA_MODEL (FULL SPEC)**

---

# 🔰 0. PURPOSE

Data Model ของ UET Platform อธิบายว่า:

- ระบบเก็บข้อมูล **อะไร** ไว้ที่ไหน
    
- โครงสร้างข้อมูลพื้นฐานที่ “ทุกฟีเจอร์ต้องใช้ร่วมกัน”
    
- ความสัมพันธ์ของข้อมูลแต่ละชุด (Relational Model)
    
- อะไรอยู่ใน DB จริง อะไรเก็บใน KV-store อะไรอยู่ใน File Storage
    
- อะไร sync เข้าหา LLM และอะไรไม่ sync
    

**นี่คือ Core ที่กำหนดอนาคตของทั้งแพลตฟอร์ม**  
ถ้าออกแบบผิด → ทุกฟีเจอร์พัง  
ถ้าออกแบบถูก → ขยายแพลตฟอร์มได้เรื่อย ๆ แบบ Obsidian + Notion + ChatGPT + Social Platform

---

# 🟩 **1. GLOBAL ENTITY OVERVIEW**

นี่คือรายการ **Entity หลักเบื้องต้นของระบบ UET Platform**

```
User
Project
File (Markdown / Source / Theory)
Folder
ChatSession
Message
KnowledgeBase
AgentTask
Notification
DonationRecord
KPIWallet
KPIRecord
SystemLog
```

ไม่เยอะ แต่เป็นแกนที่ reusable มาก  
ระบบอื่น ๆ เช่น Community, Theory, Feed จะ “ประกอบขึ้นจาก Entity เหล่านี้”

---

# 🟩 **2. HIGH-LEVEL ER DIAGRAM**

```
User ──< ProjectMember >── Project
  │                          │
  │                       ┌──┴───┐
  │                       │ File │──< VersionHistory
  │                       └──┬───┘
  │                           │
  └──< ChatSession >── Message│
                              │
KnowledgeBase ──< KBFile >────┘

User ──< KPIWallet >──< KPIRecord >

User ──< DonationRecord >

AgentTask ── belongsTo ── User / Project

Notification ── belongsTo ── User
```

อธิบายแบบง่าย:

- _Project = กล่องใหญ่ที่มีไฟล์ แชท สมาชิก KPI_
    
- _ChatSession = ประวัติการคุยของแต่ละแชท_
    
- _Message = ข้อความใน session_
    
- _File = ไฟล์ที่เห็นทุกหน้า_
    
- _KPIWallet = กระเป๋าสตางค์ KPI ที่ใช้ track อะไรก็ได้_
    
- _KnowledgeBase = ชุดของไฟล์ที่ sync เข้าหา LLM_
    

---

# 🟩 **3. CORE ENTITY SPEC**

## **3.1 User**

```
id
name
email
role            (guest / member / plus / pro / admin)
avatar
createdAt
updatedAt
settings        (theme, model default, language)
```

---

## **3.2 Project**

```
id
name
description
ownerId
visibility      (private / public)
createdAt
updatedAt
```

### ProjectMember

```
projectId
userId
role        (viewer / editor / owner)
```

---

## **3.3 File (Markdown / Doc / Theory / Etc.)**

```
id
projectId
folderId
name
type            (markdown / theory / source / data)
content
metadata        (tags, backlinks, properties)
createdBy
updatedBy
createdAt
updatedAt
```

### VersionHistory

```
id
fileId
content
diff
timestamp
editedBy
```

---

## **3.4 Folder**

```
id
projectId
parentId
name
```

---

## **3.5 ChatSession**

```
id
userId
projectId      (null = personal chat)
type           (private / friend / community)
title
createdAt
updatedAt
```

### Message

```
id
sessionId
senderId (user or 'ai')
content
model
tokensUsed
createdAt
```

---

## **3.6 KnowledgeBase (สำหรับ Source Panel)**

```
id
projectId
name
description
visibility
createdAt
updatedAt
```

### KBFile

```
kbId
fileId
status      (synced / pending / error)
```

---

## **3.7 AgentTask**

ใช้รองรับ **AutoPrompt**, **AI Actions**, **Python Simulation**, ฯลฯ

```
id
userId
projectId
type          (analysis / simulation / summarization / research)
input
output
status        (pending / running / failed / success)
logs
createdAt
updatedAt
```

---

## **3.8 DonationRecord**

```
id
userId
amount
currency
timestamp
paymentMethod
referenceId
visibility       (public / private)
```

---

## **3.9 KPIWallet**

(กระเป๋า KPI ที่กูบอก "กระเป๋าเป้าหมาย")

```
id
userId / projectId
name
goalType      (numeric / boolean / checklist)
goalValue
currentValue
createdAt
updatedAt
```

### KPIRecord

```
id
walletId
value
note
timestamp
```

---

## **3.10 Notification**

```
id
userId
title
message
actionUrl
read
createdAt
```

---

## **3.11 SystemLog**

```
id
event
payload
actorId
timestamp
```

---

# 🟩 **4. DATA STORAGE STRATEGY**

|Data Type|Storage|เหตุผล|
|---|---|---|
|User / Project / File / Session|PostgreSQL|RDBMS → query เร็ว ขยายง่าย|
|Message (Chat)|PostgreSQL + Vector Store|บางส่วนต้องทำ search|
|File Content|PostgreSQL TEXT / Blob|แก้ไข version ง่าย|
|KB Embeddings|Vector DB (PgVector / Pinecone)|RAG ใช้บ่อย|
|AgentTask result|S3-compatible|ไฟล์ผลลัพธ์เยอะ|
|Donation Slip / Media|S3|รูป/วิดีโอ|
|SystemLog|Time-series DB|ใช้ query เวลา audit|

---

# 🟩 **5. DATA FLOW (HIGH LEVEL)**

```
User → UI → API → Data Layer (DB / Vector / KV)
                  ↓
              Agent Layer
                  ↓
            Result stored → File / Task / KB
```

Simplify:

1. User ทำ action
    
2. API รับคำสั่ง
    
3. บันทึกลง DB
    
4. ถ้าเป็นไฟล์/ความรู้: push เข้า KB
    
5. Agent ใช้
    
6. ระบบคืนผลลัพธ์
    

---

# 🟩 **6. KNOWLEDGE SYNC RULES (สำคัญมาก)**

**มีเฉพาะ 3 สิ่งที่ sync เข้าหา LLM:**

1. Markdown File ที่ “ถูกเลือกเข้ามาใน KB”
    
2. Message history ที่จำเป็น (short retention)
    
3. Metadata (backlinks / tag / title)
    

**สิ่งที่ไม่ sync**

- ข้อมูลส่วนตัวผู้ใช้
    
- Donation details
    
- KPIWallet ส่วนตัว
    
- SystemLog
    

---

# 🟩 **7. SCALABILITY RULES**

- ใช้ soft-delete (deletedAt) ทุก entity
    
- ทุกตารางต้องมี index ตาม **projectId**, **userId**, **createdAt**
    
- ไฟล์ใหญ่ → จัดเก็บที่ S3 ไม่ยัดลง DB
    
- Message เก่า archive อัตโนมัติทุก 90 วัน
    
- KB re-embed ทุกครั้งที่มีการแก้ > 20%
    

---

# 🟩 **8. DATA MODEL DIAGRAM (SIMPLE)**

```
           User
            │
    ┌───────┼──────────┐
    │       │          │
Project   Chat       KPIWallet
  │        │            │
 File     Message     KPIRecord
  │
Version
```

---

# 🟩 **9. DATA MODEL DIAGRAM (FULL)**

**แบบ Enterprise-level**

```
User
├─ ProjectMember
│    └─ Project
│         ├─ Folder
│         ├─ File ── VersionHistory
│         ├─ ChatSession ── Message
│         ├─ KPIWallet ── KPIRecord
│         └─ KnowledgeBase ── KBFile
│
├─ AgentTask
├─ DonationRecord
├─ Notification
└─ SystemLog
```

---

# 🟩 **10. SUMMARY (เวอร์ชันสั้นสุด)**

- Data Model ของ UET Platform เกิดจาก 11 Entity หลัก
    
- ทุกฟีเจอร์ใน Platform ประกอบขึ้นจาก “การเชื่อมกัน” ของ Entity เหล่านี้
    
- ขยายได้ง่าย รองรับโปรเจกต์ใหญ่ กราฟข้อมูล และ AI Agent
    
- รองรับการวิเคราะห์ KPI / งบการเงิน / งานวิจัย / ฟีเจอร์แบบ Social Platform
    

---

# ถ้าต้องการฉบับแยกไฟล์ให้ใส่ใน `/schema/` เช่น

- schema/user.json
    
- schema/project.json
    
- schema/message.json
    
- schema/kpi.json
    
- schema/agent_task.json
    

บอกได้เลย เดี๋ยวจัดให้แบบ developer-ready 100%