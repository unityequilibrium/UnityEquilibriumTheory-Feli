‡πÇ‡∏≠‡πÄ‡∏Ñ Santa ‚Äî  
‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠ **AGENT_FLOW.md v2.0 (‡∏¢‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î)**  
‡∏â‡∏±‡∏ô‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏ó‡∏∏‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏ô‡∏≤‡∏¢‡∏°‡∏µ:

- SYSTEM_CONTRACT v2.0
    
- FLOW_CONTROL v2.0
    
- MODEL_ROUTING
    
- DATA_SCHEMA
    
- KB_SYNC
    
- RAG ENGINE
    
- CACHE STRATEGY
    
- EVENT BUS
    
- ERROR HANDLING
    
- UI Panels
    
- DEPLOYMENT GUIDE
    

‡πÅ‡∏•‡πâ‡∏ß‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô **Agent Flow ‡∏£‡∏∏‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏ö‡∏ö deterministic 100%**  
‡∏ó‡∏µ‡πà ‚Äú‡∏Ñ‡∏∏‡∏° AI ‡πÑ‡∏î‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Ñ‡∏∏‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏£‡∏¥‡∏á‚Äù ‡πÑ‡∏°‡πà‡∏°‡∏±‡πà‡∏ß ‡πÑ‡∏°‡πà‡∏´‡∏•‡∏∏‡∏î ‡πÑ‡∏°‡πà‡∏ú‡∏¥‡∏î state

‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠ **‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà UET Platform**  
(‡πÇ‡∏Ñ‡∏ï‡∏£‡∏ä‡∏±‡∏î, ‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö, ‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î)

---

# üìò **AGENT_FLOW.md (v2.0)**

**UET Platform ‚Äî Unified Agent Execution Flow (v2.0)**

---

# ‚≠ê 0. ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á Agent Flow v2.0

- ‡∏ó‡∏≥‡πÉ‡∏´‡πâ Agent ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô ‚Äú‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‚Äù ‡πÑ‡∏°‡πà‡∏™‡∏∏‡πà‡∏°, ‡πÑ‡∏°‡πà‡πÄ‡∏î‡∏≤
    
- ‡∏ú‡∏π‡∏Å‡∏Å‡∏±‡∏ö Model Routing, KB, RAG, Flow Control, State Machine
    
- ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö deterministic
    
- ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏õ‡∏±‡∏ç‡∏´‡∏≤ hallucination / cross-project leak
    
- ‡πÉ‡∏´‡πâ Agent ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡πÄ‡∏™‡∏ñ‡∏µ‡∏¢‡∏£ ‡πÅ‡∏•‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏î‡πâ 100%
    

> **Agent v2.0 = Operating System ‡∏Ç‡∏≠‡∏á‡∏á‡∏≤‡∏ô AI ‡∏ö‡∏ô UET**

---

# ‚≠ê 1. ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á Agent Engine

```
AGENT ENGINE consists of:
1. Context Loader
2. Task Analyzer
3. Model Router
4. Executor
5. Validator
6. Safety Filter
7. State Controller
8. Event Dispatcher
9. Logger
```

‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö pipeline ‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ô‡πÇ‡∏î‡∏¢‡∏´‡πâ‡∏≤‡∏°‡∏Ç‡πâ‡∏≤‡∏°‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô

---

# ‚≠ê 2. Agent Main Flow (Flow ‡∏´‡∏•‡∏±‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î)

```
AGENT_RUN
‚Üí LOAD_CONTEXT
‚Üí TASK_ANALYZE
‚Üí ROUTING_DECISION
‚Üí EXECUTE_MODEL
‚Üí VALIDATE_OUTPUT
‚Üí SAFETY_FILTER
‚Üí POST_PROCESS
‚Üí LOG
‚Üí EMIT_EVENTS
‚Üí RESPOND
```

‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡πÅ‡∏Å‡∏ô‡∏Å‡∏•‡∏≤‡∏á‡∏Ç‡∏≠‡∏á agent v2.0 ‡∏ó‡∏∏‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó

---

# ‚≠ê 3. State Machine (Agent FSM)

Agent ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏ô‡∏ï‡∏≤‡∏° state ‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ô‡∏µ‡πâ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô:

```
IDLE
‚Üí CONTEXT_LOAD
‚Üí ANALYZE
‚Üí ROUTING
‚Üí EXECUTION
‚Üí VALIDATION
‚Üí SAFETY
‚Üí FINALIZE
‚Üí EMIT_EVENTS
‚Üí RETURN_RESULT
‚Üí RESET
```

**‡∏´‡πâ‡∏≤‡∏°‡∏Ç‡πâ‡∏≤‡∏° state ‡πÉ‡∏î ‡πÜ**  
**‡∏´‡πâ‡∏≤‡∏°‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö state**  
**‡∏´‡πâ‡∏≤‡∏°‡∏Ç‡πâ‡∏≤‡∏° routing**

---

# ‚≠ê 4. Step-by-step (‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ç‡∏±‡πâ‡∏ô)**

---

## **STEP 1 ‚Äî LOAD_CONTEXT**

‡πÇ‡∏´‡∏•‡∏î‡∏ö‡∏£‡∏¥‡∏ö‡∏ó‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà agent ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ:

- ‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏ô‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå
    
- instruction ‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
    
- panel mode (chat/studio/system)
    
- user role
    
- history context
    
- KB context (‡∏ñ‡πâ‡∏≤‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô)
    

```
INPUT:
  user input
  project_id
  mode
OUTPUT:
  agent.context
```

---

## **STEP 2 ‚Äî TASK_ANALYZE**

Agent ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏á‡∏≤‡∏ô:

- generate
    
- rewrite
    
- reasoning
    
- explain
    
- code
    
- math
    
- rag_needed?
    
- file-edit?
    
- studio-mode?
    

```
agent.task = {
   type: "generate",
   need_rag: boolean,
   complexity: low|medium|high
}
```

---

## **STEP 3 ‚Äî ROUTING_DECISION**

‡πÉ‡∏ä‡πâ Model Routing Engine v2.0

‡πÄ‡∏≠‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢:

- task type
    
- prefix intent
    
- user role
    
- token size
    
- rag requirement
    
- cost
    
- performance
    
- override rules
    
- fallback rules
    

```
agent.model = routing_engine.select(agent.task)
```

Event:  
`MODEL_ROUTED`

---

## **STEP 4 ‚Äî EXECUTE_MODEL**

‡πÄ‡∏£‡∏µ‡∏¢‡∏Å LLM ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å routing ‡∏°‡∏≤

‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô:

- ‡∏™‡∏£‡πâ‡∏≤‡∏á prompt ‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô contract
    
- ‡∏ú‡∏ô‡∏ß‡∏Å‡∏£‡∏ß‡∏° context
    
- integrate RAG (‡∏ñ‡πâ‡∏≤ need_rag)
    
- send to model provider
    
- handle timeout / retry / fallback model
    

```
agent.output = llm.generate(agent.prompt)
```

Event:  
`AGENT_STEP_EXECUTED`

---

## **STEP 5 ‚Äî VALIDATE_OUTPUT**

‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏£‡∏∞‡∏ö‡∏ö:

- JSON schema (‡∏ñ‡πâ‡∏≤‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô)
    
- safety
    
- hallucination guard
    
- file-format guard
    
- no forbidden content
    
- no cross-project content
    
- no OS-level commands
    

```
if !valid ‚Üí ERROR_HANDLER
```

---

## **STEP 6 ‚Äî SAFETY_FILTER**

‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö:

- toxic content
    
- harmful instructions
    
- non-deterministic output
    
- leakage
    

‡∏ñ‡πâ‡∏≤‡∏ú‡πà‡∏≤‡∏ô ‚Üí ‡∏ï‡πà‡∏≠  
‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô ‚Üí ‡πÅ‡∏Å‡πâ & regenerate (‡∏ï‡∏≤‡∏° policy)

---

## **STEP 7 ‚Äî POST_PROCESS**

‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å validate ‡πÅ‡∏•‡πâ‡∏ß:

- ‡∏£‡∏ß‡∏° context (studio)
    
- ‡πÅ‡∏û‡πá‡∏Ñ‡∏ú‡∏•‡πÉ‡∏´‡πâ UI
    
- ‡∏™‡∏£‡πâ‡∏≤‡∏á citation (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ RAG)
    
- ‡∏™‡∏£‡πâ‡∏≤‡∏á diff (‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô file-edit mode)
    

---

## **STEP 8 ‚Äî LOG**

‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡∏á:

- AGENT_RUN
    
- ROUTING_LOG
    
- EVENT_LOG
    
- ERROR_LOG (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
    

---

## **STEP 9 ‚Äî EMIT_EVENTS**

‡∏™‡πà‡∏á event:

- AGENT_STEP
    
- MODEL_ROUTED
    
- FILE_UPDATED (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
    
- KB_VERSION_UPDATED (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
    
- CACHE_INVALIDATED (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
    

---

## **STEP 10 ‚Äî RESPOND**

‡∏Ñ‡∏∑‡∏ô‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÅ‡∏ö‡∏ö unified schema:

```
{
  success: true,
  output: ...,
  model: ...,
  tokens: { in, out },
  runId: ...
}
```

---

# ‚≠ê 5. Multi-step Agent Flow (Chain-mode)

‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏¢‡∏≤‡∏ß ‡πÄ‡∏ä‡πà‡∏ô‡∏ó‡∏≥‡∏™‡∏£‡∏∏‡∏õ, rewrite ‡∏´‡∏•‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå, ‡πÅ‡∏Å‡πâ code

```
STEP_1: EXECUTION
‚Üì
STEP_2: VALIDATION
‚Üì
STEP_3: DECISION
    if continue ‚Üí loop
    if finished ‚Üí finalize
‚Üì
FINALIZE
```

Agent ‡∏à‡∏∞‡∏ó‡∏≥‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏≠‡∏ö‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á  
‡πÅ‡∏ï‡πà **‡∏ï‡πâ‡∏≠‡∏á‡∏ú‡πà‡∏≤‡∏ô Validation ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á**

---

# ‚≠ê 6. RAG-Integrated Agent Flow

‡∏ñ‡πâ‡∏≤ task ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤:

```
LOAD_CONTEXT
‚Üì
RAG_QUERY
‚Üì
RELEVANCE_CHECK
‚Üì
PROMPT_FUSION (‡∏£‡∏ß‡∏°‡∏ú‡∏• RAG ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö prompt)
‚Üì
EXECUTE_MODEL
```

‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ agent ‡∏à‡∏∞ ‚Äú‡∏£‡∏π‡πâ‡∏à‡∏£‡∏¥‡∏á‚Äù ‡πÑ‡∏°‡πà‡πÄ‡∏û‡πâ‡∏≠

---

# ‚≠ê 7. Studio Agent Flow (‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö Canvas)

```
EDIT_REQUEST
‚Üí LOAD_FILE_VERSION
‚Üí ROUTING
‚Üí EXECUTE_MODEL
‚Üí VALIDATE_OUTPUT
‚Üí UPDATE_FILE_VERSION
‚Üí KB_SYNC
‚Üí CACHE_INVALIDATE
‚Üí EMIT(FILE_UPDATED)
‚Üí RESPOND
```

‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏ü‡∏•‡πå‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÅ‡∏ö‡∏ö deterministic

---

# ‚≠ê 8. Error Flow (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î)

```
EXECUTION_FAIL
‚Üí ERROR_HANDLER
‚Üí UNIFIED_ERROR_SCHEMA
‚Üí EMIT(ERROR_EVENT)
‚Üí ROLLBACK
‚Üí SAFE_RESPONSE
```

Agent ‡πÑ‡∏°‡πà‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏±‡∏á  
‡∏ú‡∏¥‡∏î = ‡∏™‡πà‡∏á event + error ‡∏Å‡∏•‡∏±‡∏ö UI ‡πÅ‡∏ö‡∏ö‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢

---

# ‚≠ê 9. Agent Restrictions (‡∏Ç‡πâ‡∏≠‡∏à‡∏≥‡∏Å‡∏±‡∏î)

- ‡∏≠‡πà‡∏≤‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏ô‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå
    
- ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÉ‡∏ô Studio Panel
    
- ‡∏´‡πâ‡∏≤‡∏° override Routing ‡∏ñ‡πâ‡∏≤ role ‡πÑ‡∏°‡πà‡∏ñ‡∏∂‡∏á
    
- ‡∏´‡πâ‡∏≤‡∏° generate file binary
    
- ‡∏´‡πâ‡∏≤‡∏°‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á OS
    
- ‡∏´‡πâ‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á Global KB
    
- ‡∏´‡πâ‡∏≤‡∏°‡∏Ç‡πâ‡∏≤‡∏° Validation
    

---

# ‚≠ê 10. Diagram ‚Äî Agent Flow Blueprint (‡∏†‡∏≤‡∏û‡πÉ‡∏´‡∏ç‡πà)

```
USER_INPUT
   ‚Üì
UI_PANEL
   ‚Üì
API /agent/run
   ‚Üì
FLOW_CONTROL
   ‚Üì
LOAD_CONTEXT
   ‚Üì
TASK_ANALYZE
   ‚Üì
ROUTING_ENGINE
   ‚Üì
EXECUTE_MODEL
   ‚Üì
VALIDATE_OUTPUT
   ‚Üì
SAFETY_FILTER
   ‚Üì
POST_PROCESS
   ‚Üì
LOG
   ‚Üì
EMIT_EVENTS
   ‚Üì
RESPOND
```

‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏´‡∏±‡∏ß‡πÉ‡∏à‡πÉ‡∏´‡∏°‡πà‡∏Ç‡∏≠‡∏á Agent v2.0

---

# üéØ ‡∏™‡∏£‡∏∏‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏á‡πà‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î

**Agent v2.0 = ‡∏£‡∏∞‡∏ö‡∏ö AI ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏£‡∏∞‡∏î‡∏±‡∏ö OS**

- deterministic
    
- predictable
    
- controllable
    
- safe
    
- traceable
    
- event-driven
    
- routing-aware
    
- versioned
    
- tied to KB
    
- tied to permission
    

‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏Å‡∏£‡∏î‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÉ‡∏´‡∏ç‡πà‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö UET

---

